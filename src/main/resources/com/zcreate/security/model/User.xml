<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zcreate.security.dao.UserMapper">
    <cache eviction="LRU" readOnly="false" flushInterval="60000" size="10000"/>
    <resultMap id="UserResult" type="com.zcreate.security.pojo.User">
        <result column="userid" jdbcType="INTEGER" property="userID"/>
        <result column="loginname" jdbcType="VARCHAR" property="loginName"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="accountnonlocked" jdbcType="BOOLEAN" property="accountNonLocked"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result property="link" column="link" javaType="com.google.gson.JsonElement"/>
        <result column="createdate" javaType="java.sql.Timestamp" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="note" jdbcType="VARCHAR" property="note"/>
        <result column="groupid" jdbcType="INTEGER" property="groupID"/>
        <result column="orderid" jdbcType="INTEGER" property="orderID"/>
        <result column="expireddate" javaType="java.sql.Timestamp" jdbcType="TIMESTAMP" property="expiredDate"/>
        <result column="lockedIP" jdbcType="VARCHAR" property="lockedIP"/>
        <result column="lockedloginip" jdbcType="BOOLEAN" property="lockedLoginIP"/>
        <result column="lastlogintime" javaType="java.sql.Timestamp" jdbcType="TIMESTAMP" property="lastLoginTime"/>
        <result column="lastloginip" jdbcType="VARCHAR" property="lastLoginIP"/>
        <result column="allowsynlogin" jdbcType="BOOLEAN" property="allowSynLogin"/>
        <result column="failurelogin" jdbcType="INTEGER" property="failureLogin"/>
        <result column="succeedlogin" jdbcType="INTEGER" property="succeedLogin"/>
    </resultMap>

    <select id="getUser" resultMap="UserResult">
        SELECT userid, loginname, password, accountnonlocked, name, link, createdate, note, groupid, orderid, expireddate, lockedip, lockedloginip,
        lastlogintime, lastloginip, allowsynlogin, failurelogin, succeedlogin
        FROM sys_user
        <where>
            <if test="param.loginname!=null">AND loginname = #{param.loginname:VARCHAR}</if>
            <if test="param.userID!=null">AND userID = #{param.userID:INTEGER}</if>
        </where>
        ORDER BY orderID
    </select>
    <select id="selectUser" resultMap="UserResult">
        SELECT
            userid, loginname, password, accountnonlocked, name, link, createdate, note, groupid, orderid, expireddate, lockedip,
            lockedloginip, lastlogintime, lastloginip, allowsynlogin, failurelogin, succeedlogin
        FROM sys_user
        ORDER BY orderID
    </select>
    <update id="updateUser">
        update sys_user
        <set>
            <if test="pojo.password != null">password = #{pojo.password:VARCHAR},</if>
            <if test="pojo.accountNonLocked != null">accountnonlocked = #{pojo.accountNonLocked:BIT},</if>
            <if test="pojo.name != null">name = #{pojo.name:VARCHAR},</if>
            <if test="pojo.link != null">link = #{pojo.link:OTHER},</if>
            <if test="@com.zcreate.util.Ognl@isNotEmpty(pojo.createDate)">createdate = #{pojo.createDate:TIMESTAMP},</if>
            <if test="pojo.note != null">note = #{pojo.note:VARCHAR},</if>
            <if test="pojo.groupID != null">groupid = #{pojo.groupID:INTEGER},</if>
            <if test="pojo.orderID != null">orderid = #{pojo.orderID:INTEGER},</if>
            <if test="pojo.expiredDate != null">expireddate = #{pojo.expiredDate:TIMESTAMP},</if>
            <if test="pojo.lockedIP != null">lockedip = #{pojo.lockedIP:VARCHAR},</if>
            <if test="pojo.lockedLoginIP != null">lockedloginip = #{pojo.lockedLoginIP:BIT},</if>
            <if test="pojo.lastLogintime != null">lastlogintime = #{pojo.lastLoginTime:TIMESTAMP},</if>
            <if test="pojo.lastLoginIP != null">lastloginip = #{pojo.lastLoginIP:VARCHAR},</if>
            <if test="pojo.allowSynLogin != null">allowsynlogin = #{pojo.allowSynLogin:BIT},</if>
            <if test="pojo.failureLogin != null">failurelogin = #{pojo.failureLogin:INTEGER},</if>
            <if test="pojo.failureLogin != null">succeedlogin = #{pojo.succeedLogin:INTEGER},</if>
        </set>
        /*,updatetime=now()*/
        where loginname = #{pojo.username:VARCHAR}
    </update>
    <insert id="insertUser" flushCache="true" useGeneratedKeys="true" keyProperty="pojo.userID">
        INSERT INTO sys_user (loginname, password, accountnonlocked, name, link,   note, groupid, orderid, expireddate,
                              lockedip, lockedloginip,  lastloginip, allowsynlogin )
        VALUES (#{pojo.username:VARCHAR}, #{pojo.password:VARCHAR}, #{pojo.accountNonLocked:BIT},
                                          #{pojo.name:VARCHAR}, #{pojo.link:OTHER},
                                          #{pojo.note:VARCHAR}, #{pojo.groupID:INTEGER}, #{pojo.orderID:INTEGER},
                                          #{pojo.expiredDate:TIMESTAMP}, #{pojo.lockedIP:VARCHAR}, #{pojo.lockedLoginIP:BIT},
                 #{pojo.lastLoginIP:VARCHAR}, #{pojo.allowSynLogin:BIT} )
    </insert>
    <delete id="deleteUser">
        DELETE FROM sys_user
        WHERE userID = #{userID:INTEGER}
    </delete>
</mapper>